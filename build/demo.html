<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test harness for filter-tree.js</title>
    <link rel="stylesheet" href="demo.css"/>
    <script src="lib/filter-tree.js"></script>
    <script src="demo.js"></script>
</head>
<body>
<table style="width:100%"><tr><td>

    <fieldset>
        <legend>Initialize with this <code>fields</code> list and the <code>filterJSON</code> below</legend>
        <input type="button" value="initialize({ fields: fields, state: filterJSON })" onclick="harness.initialize()"
         title="Creates a new filter tree object bound to a new filter tree UI element. This demo replaces the existing UI element with the new one." />
        <textarea id="fields" rows="6">[
    { submenu: ['LastName', 'FirstName'], label: 'Names' },
    'BirthState',
    { name: 'DOB', alias: 'Date Of Birth', type: 'date' },
    { name: 'Age', type: 'number' }
]</textarea>
    <p>Format: JavaScript array literal syntax</p>
    </fieldset>

    <fieldset>
        <legend><code>filterJSON</code></legend>
        <input type="button" value="filterJSON = filter.getJSON() // serialize the UI state" onclick="harness.toJSON()"
         title="Generate JSON describing the filter expression in the UI."/>
        <label style="float:right; font-size:10pt"
         title="Automatically regenerate the JSON on any manual change to the UI.">
            <input type="checkbox" id="autoget" onclick="if(this.checked)harness.toJSON()"/>Auto
        </label>
        <textarea id="json-data" rows="6">{
   "operator": "op-and",
   "children": [
      {
         "operator": "op-or",
         "children": [
            {
               "column": "DOB",
               "operator": "<",
               "literal": "1/1/1950"
            },
            {
               "column": "Age",
               "operator": "=",
               "literal": "69"
            }
         ]
      }
   ]
}</textarea>
        <p>Format: JSON syntax (<a href="http://www.json.org/" target="json_org">strict</a>), with all property names and strings in double-quotes)</p>
        <input type="button" value="filter.setJSON(filterJSON) // reset the UI state to match" onclick="harness.setState('json-data')" style="margin-top:.7em"
               title="Regnerate the filter tree UI element based on the filter expression described by the JSON. Replace the old element with this new one." />
    </fieldset>

    <fieldset>
        <legend>SQL <code>WHERE</code> clause describing filter expression</legend>
        <input type="button" value="WHERE = getSqlWhereClause() // serialize the UI state" onclick="harness.getSqlWhereClause(true)" />
        <label style="float:right; font-size:10pt"
               title="Automatically regenerate the SQL on any manual change to the UI.">
            <input type="checkbox" id="autoGetWhere" checked onclick="if(this.checked)harness.getSqlWhereClause()"/>Auto
        </label>
        <textarea id="where-data" rows="3" onkeyup="if(document.getElementById('autoSetWhere').checked)harness.setState('where-data')"></textarea>
        <input type="button" value="setSqlWhereClause(WHERE) // reset the UI state to match"
               onclick="harness.setState('where-data')"
               title="Regenerate the filter tree UI element based on the filter expression described by the WHERE clause text. Replace the old element with this new one." />
        <span style="font-style:italic; font-size: 7pt">(beta)</span>
        <label style="float:right; font-size:10pt"
               title="Automatically regenerate the SQL on any manual change to the UI.">
            <input type="checkbox" id="autoSetWhere" checked onclick="if(this.checked)harness.setState('where-data')"/>Auto
        </label>
    </fieldset>

    <fieldset>
        <legend>Test the filter expression against this <code>dataRow</code></legend>
        <input type="button" value="test(dataRow)" onclick="harness.test(true)" /> &#x27f9;
        <label style="float:right; font-size:10pt"
         title="Automatically retest this data row against the filter expression in the UI on any manual change to same.">
            <input type="checkbox" id="autotest" checked onclick="if(this.checked)harness.test()"/>Auto
        </label>
        <span id="test-result"></span><br/>
        <textarea id="dataRow" rows="6">{
    LastName: 'Clinton',
    DOB: '1/19/1946',
    Age: 69
}</textarea>
    <p>Format: JavaScript object literal syntax</p>
    </fieldset>

</td><td style="white-space:nowrap">

    <div style="width:216px; height:64px; display: inline-block; position:relative; background-image:url(filters.png); background-size:100%; background-repeat: no-repeat">
        <input name="LastName" class="filter-box" readonly autocomplete="off" />
        <input name="BirthState" class="filter-box" style="left:111px" readonly autocomplete="off" />
    </div>

    <div style="display: inline-block; font-size: small; margin-left: 1em">
        <div style="color: red">
            <em style="margin-left:2em">click</em><br/>
            <em style="margin-left:2em">these</em><br/>
            &#x21D0; &nbsp; <em>filters!</em>
        </div>
        <div style="font-size:xx-small">&nbsp;</div>
    </div>

    <div style="display: inline-block; white-space: nowrap; margin-left: 1em; font-size: 9pt; text-align: center; border:1px solid grey;padding-bottom:2px">
        <div style="margin-bottom: 3px; padding-bottom: 3px; padding-top:2px; background-color:grey; color:white; font-weight:bold">examples:</div>
        <code style="font-size: 8pt; letter-spacing: 1px; font-weight: normal">
            50<br/>
            < 50<br/>
            &nbsp;>=A and <=L&nbsp;<br/>
        </code>
    </div>
    <div id="properties" style="font-size:9pt; margin:1em">
    Recognize column names typed in above by
        <label><input type="checkbox" class="property" id="AUTO_COLUMN_LOOKUP_BY_NAME" checked> name</label>
        <label><input type="checkbox" class="property" id="AUTO_COLUMN_LOOKUP_BY_ALIAS" checked> alias</label>
        (<label><input type="checkbox" class="property" id="CASE_SENSITIVE_COLUMN_NAMES"> case-sensitive</label>)
    </div>

    <fieldset id="filter" style="white-space:nowrap; min-height:635px">
        <legend>Filter expression user interface</legend>
        <input type="button" value="validate()" onclick="harness.validate()" style="margin:-1em 0 1em .5em;float:right" />
    </fieldset>

    <div class="msg-box">
        <div class="msg-box-title">Column filter cell syntax error</div>
        <div class="msg-box-close"></div>
        <div class="msg-box-content"></div>
    </div>

</td></tr></table>
</body>
</html>
